#include <stdio.h>
#include <string.h>
#include <stdlib.h>

char* xor_decipher(char* input, char* key, int length) {
    char* output = (char*) malloc(sizeof(char) * (length + 1));
    for (int i = 0; i < length; ++i) {
        output[i] = input[i] ^ key[i%strlen(key)];
    }
    output[length] = '\0';
    return output;
}

char* caesar_decipher(char* input, int shift) {
    int length = strlen(input);
    char* output = (char*) malloc(sizeof(char) * (length + 1));
    for (int i = 0; i < length; ++i) {
        char c = input[i];
        if (c >= 'a' && c <= 'z') {
            c = ((c - 'a' + shift) % 26) + 'a';
        } else if (c >= 'A' && c <= 'Z') {
            c = ((c - 'A' + shift) % 26) + 'A';
        }
        output[i] = c;
    }
    output[length] = '\0';
    return output;
}

char* reverse_decipher(char* input) {
    int length = strlen(input);
    char* output = (char*) malloc(sizeof(char) * (length + 1));
    for (int i = 0; i < length; ++i) {
        output[i] = input[length - 1 - i];
    }
    output[length] = '\0';
    return output;
}

int check_part1(char* input) {
    char encoded[] = {0x10, 0x11, 0x10, 0x00}; // "sec" xor-encoded with key "abc"
    char* key = "abc";
    char* decoded = xor_decipher(encoded, key, strlen(encoded) - 1);
    int result = strncmp(input, decoded, 3) == 0;
    free(decoded);
    return result;
}

int check_part2(char* input) {
    char encoded[] = "uhw"; // "ret" caesar-encoded with shift of 3
    int shift = 3;
    char* decoded = caesar_decipher(encoded, shift);
    int result = strncmp(input, decoded, 3) == 0;
    free(decoded);
    return result;
}

int check_part3(char* input) {
    char encoded[] = "ssap"; // "pass" reversed
    char* decoded = reverse_decipher(encoded);
    int result = strcmp(input, decoded) == 0;
    free(decoded);
    return result;
}

int main() {
    char password[16];
    printf("Enter the password: ");
    fgets(password, 16, stdin);
    password[strcspn(password, "\n")] = '\0'; // Remove trailing newline

    if (check_part1(password) && check_part2(password + 3) && check_part3(password + 6)) {
        printf("Congratulations! You've defused the bomb!\n");
    } else {
        printf("BOOM!\n");
    }
    return 0;
}
